import {
  GovernanceReview,
  ApprovalChain,
  AuditLogEntry,
} from "@/types/platform";

// Mock governance reviews covering the full range of reviewer actions.
// Linked to observations from the normalization-records mock data.
export const governanceReviews: GovernanceReview[] = [
  {
    id: "gr-001",
    observation_id: "obs-001",
    metric_name: "Total Operating Revenue",
    entity_name: "SUNY Buffalo",
    value: 1892450000,
    unit: "USD",
    reviewer_id: "user-001",
    reviewer_name: "Sarah Chen",
    action: "approve",
    comment: "Verified against audited statements",
    previous_status: "validated",
    new_status: "approved",
    created_at: "2024-09-15T10:00:00Z",
  },
  {
    id: "gr-002",
    observation_id: "obs-003",
    metric_name: "Research Expenditures",
    entity_name: "UT Austin",
    value: 780234000,
    unit: "USD",
    reviewer_id: "user-002",
    reviewer_name: "James Wilson",
    action: "approve",
    comment: "Matches HERD survey data",
    previous_status: "validated",
    new_status: "approved",
    created_at: "2024-09-16T09:30:00Z",
  },
  {
    id: "gr-003",
    observation_id: "obs-005",
    metric_name: "First-Year Retention Rate",
    entity_name: "SUNY Buffalo",
    value: 88.2,
    unit: "percentage",
    reviewer_id: "user-003",
    reviewer_name: "Maria Santos",
    action: "approve",
    comment: "Consistent with prior year trend",
    previous_status: "validated",
    new_status: "approved",
    created_at: "2024-09-17T11:15:00Z",
  },
  {
    id: "gr-004",
    observation_id: "obs-007",
    metric_name: "Total Enrollment",
    entity_name: "U of Michigan",
    value: 47907,
    unit: "count",
    reviewer_id: "user-002",
    reviewer_name: "James Wilson",
    action: "approve",
    comment: undefined,
    previous_status: "validated",
    new_status: "approved",
    created_at: "2024-09-18T08:45:00Z",
  },
  {
    id: "gr-005",
    observation_id: "obs-011",
    metric_name: "Research Expenditures",
    entity_name: "Ohio State",
    value: 1450000000,
    unit: "USD",
    reviewer_id: "user-001",
    reviewer_name: "Sarah Chen",
    action: "reject",
    comment:
      "Value includes medical center\u2014needs restatement per standard methodology",
    previous_status: "validated",
    new_status: "rejected",
    created_at: "2024-09-19T14:20:00Z",
  },
  {
    id: "gr-006",
    observation_id: "obs-004",
    metric_name: "Endowment Market Value",
    entity_name: "UC Berkeley",
    value: 5700000000,
    unit: "USD",
    reviewer_id: "user-004",
    reviewer_name: "Robert Kim",
    action: "approve",
    comment: "Confirmed with NACUBO report",
    previous_status: "validated",
    new_status: "approved",
    created_at: "2024-09-20T10:00:00Z",
  },
  {
    id: "gr-007",
    observation_id: "obs-009",
    metric_name: "Deferred Maintenance",
    entity_name: "SUNY Buffalo",
    value: 800000000,
    unit: "USD",
    reviewer_id: "user-003",
    reviewer_name: "Maria Santos",
    action: "request_change",
    comment:
      "Source uses approximate value (~$800M). Request exact figure from facilities.",
    previous_status: "validated",
    new_status: "change_requested",
    created_at: "2024-09-22T13:40:00Z",
  },
  {
    id: "gr-008",
    observation_id: "obs-012",
    metric_name: "Total Degrees Awarded",
    entity_name: "SUNY Buffalo",
    value: 8000,
    unit: "count",
    reviewer_id: "user-002",
    reviewer_name: "James Wilson",
    action: "escalate",
    comment: "Text-based extraction\u2014needs data owner confirmation",
    previous_status: "validated",
    new_status: "escalated",
    created_at: "2024-09-23T09:10:00Z",
  },
  {
    id: "gr-009",
    observation_id: "obs-002",
    metric_name: "Net Tuition Revenue",
    entity_name: "SUNY Buffalo",
    value: 423000000,
    unit: "USD",
    reviewer_id: "user-004",
    reviewer_name: "Robert Kim",
    action: "approve",
    comment: undefined,
    previous_status: "validated",
    new_status: "approved",
    created_at: "2024-09-24T15:30:00Z",
  },
  {
    id: "gr-010",
    observation_id: "obs-006",
    metric_name: "Six-Year Graduation Rate",
    entity_name: "UT Austin",
    value: 82.0,
    unit: "percentage",
    reviewer_id: "user-001",
    reviewer_name: "Sarah Chen",
    action: "comment",
    comment: "Note: this uses updated IPEDS methodology for 2024",
    previous_status: "validated",
    new_status: "validated",
    created_at: "2024-10-01T11:00:00Z",
  },
];

// Multi-step approval chains that govern how observations move through review.
export const approvalChains: ApprovalChain[] = [
  {
    id: "chain-001",
    name: "Standard Metric Approval",
    description:
      "Default three-step approval for most metric observations. Analyst review with optional auto-approve, followed by data owner and admin sign-off.",
    steps: [
      {
        order: 1,
        role_required: "Analyst",
        action_required: "approve",
        auto_approve_threshold: 0.9,
      },
      {
        order: 2,
        role_required: "Data Owner",
        action_required: "approve",
      },
      {
        order: 3,
        role_required: "Admin",
        action_required: "approve",
      },
    ],
    is_active: true,
  },
  {
    id: "chain-002",
    name: "High-Value Financial Metric",
    description:
      "Stricter approval chain for high-value financial metrics (revenue, endowment, expenditures). No auto-approve; requires Financial Analyst, Controller, and CFO sign-off.",
    steps: [
      {
        order: 1,
        role_required: "Financial Analyst",
        action_required: "approve",
      },
      {
        order: 2,
        role_required: "Controller",
        action_required: "approve",
      },
      {
        order: 3,
        role_required: "CFO",
        action_required: "approve",
      },
    ],
    is_active: true,
  },
  {
    id: "chain-003",
    name: "External Benchmark Import",
    description:
      "Two-step approval for externally sourced benchmark data. Data Quality Analyst with high auto-approve threshold, followed by Research Analyst verification.",
    steps: [
      {
        order: 1,
        role_required: "Data Quality Analyst",
        action_required: "approve",
        auto_approve_threshold: 0.95,
      },
      {
        order: 2,
        role_required: "Research Analyst",
        action_required: "approve",
      },
    ],
    is_active: true,
  },
];

// Chronological audit log covering platform activity from Aug 15 to Oct 1, 2024.
export const auditLog: AuditLogEntry[] = [
  {
    id: "audit-001",
    timestamp: "2024-08-15T08:00:00Z",
    user_id: "user-001",
    user_name: "Sarah Chen",
    action: "user_login",
    resource_type: "user",
    resource_id: "user-001",
    details: { ip_address: "10.0.1.42", session_id: "sess-20240815-001" },
  },
  {
    id: "audit-002",
    timestamp: "2024-08-16T09:30:00Z",
    user_id: "user-001",
    user_name: "Sarah Chen",
    action: "metric_created",
    resource_type: "glossary_metric",
    resource_id: "M_REVENUE_TOTAL",
    details: {
      metric_name: "Total Operating Revenue",
      domain: "financial",
      unit: "USD",
    },
  },
  {
    id: "audit-003",
    timestamp: "2024-08-17T10:15:00Z",
    user_id: "user-002",
    user_name: "James Wilson",
    action: "metric_created",
    resource_type: "glossary_metric",
    resource_id: "M_RETENTION_FY",
    details: {
      metric_name: "First-Year Retention Rate",
      domain: "academic",
      unit: "percentage",
    },
  },
  {
    id: "audit-004",
    timestamp: "2024-08-20T11:00:00Z",
    user_id: "user-001",
    user_name: "Sarah Chen",
    action: "metric_updated",
    resource_type: "glossary_metric",
    resource_id: "M_REVENUE_TOTAL",
    details: {
      field_changed: "calculation_logic",
      previous_value: "sum of all operating revenue lines",
      new_value:
        "sum of tuition, state appropriations, grants, auxiliary, and other operating revenue",
    },
  },
  {
    id: "audit-005",
    timestamp: "2024-08-22T14:30:00Z",
    user_id: "user-003",
    user_name: "Maria Santos",
    action: "document_uploaded",
    resource_type: "source_document",
    resource_id: "doc-001",
    details: {
      document_name: "Annual Financial Report FY2024.pdf",
      entity: "SUNY Buffalo",
      file_size: "4.2 MB",
    },
  },
  {
    id: "audit-006",
    timestamp: "2024-08-23T08:45:00Z",
    user_id: "user-003",
    user_name: "Maria Santos",
    action: "document_processed",
    resource_type: "source_document",
    resource_id: "doc-001",
    details: {
      pages_parsed: "42",
      tables_detected: "15",
      processing_time_ms: "113000",
    },
  },
  {
    id: "audit-007",
    timestamp: "2024-08-25T09:00:00Z",
    user_id: "user-002",
    user_name: "James Wilson",
    action: "extraction_started",
    resource_type: "extraction_run",
    resource_id: "ext-001",
    details: {
      source_document: "doc-001",
      method: "hybrid",
      entity: "SUNY Buffalo",
    },
  },
  {
    id: "audit-008",
    timestamp: "2024-08-25T09:15:00Z",
    user_id: "user-002",
    user_name: "James Wilson",
    action: "extraction_completed",
    resource_type: "extraction_run",
    resource_id: "ext-001",
    details: {
      total_candidates: "12",
      matched_to_glossary: "10",
      unmatched: "2",
      confidence_avg: "0.91",
    },
  },
  {
    id: "audit-009",
    timestamp: "2024-08-28T10:30:00Z",
    user_id: "user-004",
    user_name: "Robert Kim",
    action: "observation_created",
    resource_type: "metric_observation",
    resource_id: "obs-001",
    details: {
      metric: "Total Operating Revenue",
      entity: "SUNY Buffalo",
      value: "1892450000",
      unit: "USD",
    },
  },
  {
    id: "audit-010",
    timestamp: "2024-09-01T11:00:00Z",
    user_id: "user-001",
    user_name: "Sarah Chen",
    action: "quality_check_run",
    resource_type: "quality_report",
    resource_id: "qr-001",
    details: {
      entity: "SUNY Buffalo",
      total_checks: "18",
      passed: "16",
      failed: "1",
      warnings: "1",
    },
  },
  {
    id: "audit-011",
    timestamp: "2024-09-03T09:20:00Z",
    user_id: "user-003",
    user_name: "Maria Santos",
    action: "normalization_applied",
    resource_type: "normalization_record",
    resource_id: "nr-001",
    details: {
      metric: "Total Operating Revenue",
      raw_value: "$1.89B",
      normalized_value: "1892450000",
      method: "unit_expansion",
    },
  },
  {
    id: "audit-012",
    timestamp: "2024-09-05T13:45:00Z",
    user_id: "user-002",
    user_name: "James Wilson",
    action: "grounding_verified",
    resource_type: "grounding_verification",
    resource_id: "gv-001",
    details: {
      observation: "obs-001",
      verdict: "verified",
      confidence: "0.95",
      source_document: "doc-001",
    },
  },
  {
    id: "audit-013",
    timestamp: "2024-09-08T08:00:00Z",
    user_id: "user-004",
    user_name: "Robert Kim",
    action: "observation_validated",
    resource_type: "metric_observation",
    resource_id: "obs-001",
    details: {
      metric: "Total Operating Revenue",
      entity: "SUNY Buffalo",
      quality_score: "0.94",
      grounding_verdict: "verified",
    },
  },
  {
    id: "audit-014",
    timestamp: "2024-09-10T14:00:00Z",
    user_id: "user-001",
    user_name: "Sarah Chen",
    action: "document_uploaded",
    resource_type: "source_document",
    resource_id: "doc-009",
    details: {
      document_name: "Research Expenditures FY2023.pdf",
      entity: "UC Berkeley",
      file_size: "2.8 MB",
    },
  },
  {
    id: "audit-015",
    timestamp: "2024-09-12T10:30:00Z",
    user_id: "user-002",
    user_name: "James Wilson",
    action: "extraction_started",
    resource_type: "extraction_run",
    resource_id: "ext-003",
    details: {
      source_document: "doc-009",
      method: "rule_based",
      entity: "UC Berkeley",
    },
  },
  {
    id: "audit-016",
    timestamp: "2024-09-12T10:42:00Z",
    user_id: "user-002",
    user_name: "James Wilson",
    action: "extraction_completed",
    resource_type: "extraction_run",
    resource_id: "ext-003",
    details: {
      total_candidates: "5",
      matched_to_glossary: "5",
      unmatched: "0",
      confidence_avg: "0.97",
    },
  },
  {
    id: "audit-017",
    timestamp: "2024-09-15T10:00:00Z",
    user_id: "user-001",
    user_name: "Sarah Chen",
    action: "observation_approved",
    resource_type: "metric_observation",
    resource_id: "obs-001",
    details: {
      metric: "Total Operating Revenue",
      entity: "SUNY Buffalo",
      reviewer: "Sarah Chen",
      comment: "Verified against audited statements",
    },
  },
  {
    id: "audit-018",
    timestamp: "2024-09-19T14:20:00Z",
    user_id: "user-001",
    user_name: "Sarah Chen",
    action: "observation_rejected",
    resource_type: "metric_observation",
    resource_id: "obs-011",
    details: {
      metric: "Research Expenditures",
      entity: "Ohio State",
      reviewer: "Sarah Chen",
      reason: "Value includes medical center partnerships",
    },
  },
  {
    id: "audit-019",
    timestamp: "2024-09-25T16:00:00Z",
    user_id: "user-003",
    user_name: "Maria Santos",
    action: "observation_created",
    resource_type: "metric_observation",
    resource_id: "obs-010",
    details: {
      metric: "Auxiliary Margin",
      entity: "UC Berkeley",
      value: "12.3",
      unit: "percentage",
    },
  },
  {
    id: "audit-020",
    timestamp: "2024-10-01T07:30:00Z",
    user_id: "user-004",
    user_name: "Robert Kim",
    action: "user_login",
    resource_type: "user",
    resource_id: "user-004",
    details: { ip_address: "10.0.1.88", session_id: "sess-20241001-004" },
  },
];

// Helper: filter governance reviews by action type
export const getReviewsByAction = (action: string): GovernanceReview[] =>
  governanceReviews.filter((review) => review.action === action);

// Helper: return reviews that are still pending â€” comments or observations not yet decisively reviewed
export const getPendingReviews = (): GovernanceReview[] =>
  governanceReviews.filter(
    (review) =>
      review.action === "comment" ||
      review.action === "escalate" ||
      review.action === "request_change"
  );

// Helper: filter audit log entries by resource type
export const getAuditLogByResource = (
  resourceType: string
): AuditLogEntry[] =>
  auditLog.filter((entry) => entry.resource_type === resourceType);
