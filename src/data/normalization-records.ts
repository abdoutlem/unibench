import { NormalizationRecord, NormalizationRule } from "@/types/platform";

// Mock normalization records demonstrating various unit/format conversions
// aligned with the canonical metric observation pipeline.
export const normalizationRecords: NormalizationRecord[] = [
  {
    id: "nr-001",
    observation_id: "obs-001",
    metric_id: "M_REVENUE_TOTAL",
    metric_name: "Total Operating Revenue",
    entity_name: "SUNY Buffalo",
    raw_value: "$1.89B",
    raw_unit: "USD_abbreviated",
    normalized_value: 1892450000,
    normalized_unit: "USD",
    normalization_method: "unit_expansion",
    status: "normalized",
    normalized_at: "2024-09-10T08:12:00Z",
  },
  {
    id: "nr-002",
    observation_id: "obs-002",
    metric_id: "M_TUITION_NET",
    metric_name: "Net Tuition Revenue",
    entity_name: "SUNY Buffalo",
    raw_value: "$423M",
    raw_unit: "USD_abbreviated",
    normalized_value: 423000000,
    normalized_unit: "USD",
    normalization_method: "unit_expansion",
    status: "normalized",
    normalized_at: "2024-09-10T08:12:15Z",
  },
  {
    id: "nr-003",
    observation_id: "obs-003",
    metric_id: "M_RESEARCH_EXPENDITURE",
    metric_name: "Research Expenditures",
    entity_name: "UT Austin",
    raw_value: "780,234,000",
    raw_unit: "USD",
    normalized_value: 780234000,
    normalized_unit: "USD",
    normalization_method: "format_cleanup",
    status: "normalized",
    normalized_at: "2024-09-10T08:14:30Z",
  },
  {
    id: "nr-004",
    observation_id: "obs-004",
    metric_id: "M_ENDOWMENT_VALUE",
    metric_name: "Endowment Market Value",
    entity_name: "UC Berkeley",
    raw_value: "$5.7 billion",
    raw_unit: "USD_text",
    normalized_value: 5700000000,
    normalized_unit: "USD",
    normalization_method: "text_to_numeric",
    status: "normalized",
    normalized_at: "2024-09-10T08:15:00Z",
  },
  {
    id: "nr-005",
    observation_id: "obs-005",
    metric_id: "M_RETENTION_FY",
    metric_name: "First-Year Retention Rate",
    entity_name: "SUNY Buffalo",
    raw_value: "0.882",
    raw_unit: "decimal",
    normalized_value: 88.2,
    normalized_unit: "percentage",
    normalization_method: "scale_conversion",
    status: "normalized",
    normalized_at: "2024-09-10T08:16:45Z",
  },
  {
    id: "nr-006",
    observation_id: "obs-006",
    metric_id: "M_GRADUATION_6YR",
    metric_name: "Six-Year Graduation Rate",
    entity_name: "UT Austin",
    raw_value: "82%",
    raw_unit: "percentage",
    normalized_value: 82.0,
    normalized_unit: "percentage",
    normalization_method: "format_cleanup",
    status: "normalized",
    normalized_at: "2024-09-10T08:17:10Z",
  },
  {
    id: "nr-007",
    observation_id: "obs-007",
    metric_id: "M_ENROLLMENT_TOTAL",
    metric_name: "Total Enrollment",
    entity_name: "U of Michigan",
    raw_value: "47,907",
    raw_unit: "count",
    normalized_value: 47907,
    normalized_unit: "count",
    normalization_method: "format_cleanup",
    status: "normalized",
    normalized_at: "2024-09-10T08:18:00Z",
  },
  {
    id: "nr-008",
    observation_id: "obs-008",
    metric_id: "M_STUDENT_FACULTY_RATIO",
    metric_name: "Student-Faculty Ratio",
    entity_name: "Ohio State",
    raw_value: "15 to 1",
    raw_unit: "text_ratio",
    normalized_value: 15.0,
    normalized_unit: "ratio",
    normalization_method: "text_to_numeric",
    status: "normalized",
    normalized_at: "2024-09-10T08:19:22Z",
  },
  {
    id: "nr-009",
    observation_id: "obs-009",
    metric_id: "M_DEFERRED_MAINTENANCE",
    metric_name: "Deferred Maintenance",
    entity_name: "SUNY Buffalo",
    raw_value: "~$800M",
    raw_unit: "USD_approximate",
    normalized_value: 800000000,
    normalized_unit: "USD",
    normalization_method: "approximate_to_exact",
    status: "normalized",
    normalized_at: "2024-09-10T08:20:05Z",
  },
  {
    id: "nr-010",
    observation_id: "obs-010",
    metric_id: "M_AUXILIARY_MARGIN",
    metric_name: "Auxiliary Margin",
    entity_name: "UC Berkeley",
    raw_value: "12.3 percent",
    raw_unit: "text_percentage",
    normalized_value: 12.3,
    normalized_unit: "percentage",
    normalization_method: "text_to_numeric",
    status: "normalized",
    normalized_at: "2024-09-10T08:21:30Z",
  },
  {
    id: "nr-011",
    observation_id: "obs-011",
    metric_id: "M_RESEARCH_EXPENDITURE",
    metric_name: "Research Expenditures",
    entity_name: "Ohio State",
    raw_value: "$1.45bn",
    raw_unit: "USD_abbreviated",
    normalized_value: 1450000000,
    normalized_unit: "USD",
    normalization_method: "unit_expansion",
    status: "failed",
    notes: "Ambiguous: value may include medical center partnerships",
    normalized_at: "2024-09-10T08:22:50Z",
  },
  {
    id: "nr-012",
    observation_id: "obs-012",
    metric_id: "M_DEGREES_AWARDED",
    metric_name: "Total Degrees Awarded",
    entity_name: "SUNY Buffalo",
    raw_value: "eight thousand",
    raw_unit: "text_number",
    normalized_value: 8000,
    normalized_unit: "count",
    normalization_method: "text_to_numeric",
    status: "manual_override",
    notes: "Manual override: text-to-number conversion from narrative text, rounded to nearest thousand",
    normalized_at: "2024-09-10T08:25:00Z",
  },
];

// Reusable normalization rules that map source units to target units.
// Rules with metric_id = undefined apply to ALL metrics carrying the matching source_unit.
export const normalizationRules: NormalizationRule[] = [
  {
    id: "nrule-001",
    metric_id: undefined,
    metric_name: undefined,
    source_unit: "USD_abbreviated",
    target_unit: "USD",
    conversion_formula:
      "parse_abbreviation(value, 'B'=1e9, 'M'=1e6, 'K'=1e3)",
    is_active: true,
  },
  {
    id: "nrule-002",
    metric_id: undefined,
    metric_name: undefined,
    source_unit: "decimal",
    target_unit: "percentage",
    conversion_formula: "value * 100",
    is_active: true,
  },
  {
    id: "nrule-003",
    metric_id: undefined,
    metric_name: undefined,
    source_unit: "text_ratio",
    target_unit: "ratio",
    conversion_formula: "parse_ratio(value, separator='to')",
    is_active: true,
  },
  {
    id: "nrule-004",
    metric_id: undefined,
    metric_name: undefined,
    source_unit: "text_percentage",
    target_unit: "percentage",
    conversion_formula: "parse_numeric(remove_text(value))",
    is_active: true,
  },
  {
    id: "nrule-005",
    metric_id: undefined,
    metric_name: undefined,
    source_unit: "USD_text",
    target_unit: "USD",
    conversion_formula: "parse_text_currency(value)",
    is_active: true,
  },
  {
    id: "nrule-006",
    metric_id: undefined,
    metric_name: undefined,
    source_unit: "text_number",
    target_unit: "count",
    conversion_formula: "text_to_number(value)",
    is_active: false,
  },
];

// Helper: filter normalization records by status
export const getNormalizationByStatus = (
  status: string
): NormalizationRecord[] =>
  normalizationRecords.filter((record) => record.status === status);

// Helper: return only active normalization rules
export const getActiveNormalizationRules = (): NormalizationRule[] =>
  normalizationRules.filter((rule) => rule.is_active);
